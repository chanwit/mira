MACHINE_HOME = "c:/test"
REPO = "chanwit"
TAG  = "v1"

include 'digitalocean.templates'
apply plugin: 'swarm'

services = [worker, webui, redis, hasher, rng]

INSTANCES = 10

swarm {
	managers dragon0..dragon2
	workers  dragon3..dragon9
}

task(up) {
	docker service create (
		name:  nginx,
		image: nginx,
	)
}

task(down) {
	docker service rm nginx
}

task(provision) {
	INSTANCES.times {
		docker machine create DO_1GB_SGP, "dragon$it"
	}
}

task(clean) {
	INSTANCES.times {
		docker machine rm "dragon$it"
	}
}

task(push) {
	/*
	TOKEN = docker swarm join-token manager
	println TOKEN
	TOKEN = docker swarm join-token worker
	println TOKEN
	*/
	// docker network create (driver: "overlay", mynet)
	// docker push "chanwit/webui:v1"
	// docker push "chanwit/webui:v1"
}